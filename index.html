<!DOCTYPE html>
<html lang="ja">
<head>
  <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ ãã˜å¼•ã | Sweet Family</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #fff5fb;
      color: #4a004a;
      text-align: center;
      padding: 2rem;
    }
    .container {
      background: #ffffff;
      border-radius: 1.5rem;
      padding: 2rem;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    .logo {
      width: 90%;
      max-width: 360px;
      margin-bottom: 2rem;
    }
    .cupom {
      background: #ffcbeb;
      padding: 1.5rem;
      border-radius: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
      margin: 1.5rem 0 0.5rem;
    }
    .cupom-desconto {
      font-size: 0.95rem;
      color: #4a004a;
    }
    .cupom-desconto span {
      font-size: 1.4em;
      font-weight: bold;
      color: #e10098;
    }
    .validade {
      font-size: 0.9rem;
      color: #888;
    }
    .botao-salvar {
      background-color: #ff92d0;
      color: white;
      border: none;
      padding: 1rem 2rem;
      font-size: 1rem;
      font-weight: bold;
      border-radius: 2rem;
      cursor: pointer;
      margin-top: 1rem;
      transition: background-color 0.3s ease;
    }
    .botao-salvar:hover {
      background-color: #e86db2;
    }
    .instrucoes {
      margin-top: 2rem;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    .imagem-teclado {
      margin-top: 1rem;
      max-width: 240px;
      border-radius: 2rem;
      box-shadow: 0 0 6px rgba(0,0,0,0.2);
    }
    .idiomas {
      position: absolute;
      top: 1rem;
      right: 1rem;
    }
    .idiomas button {
      background: transparent;
      border: none;
      font-weight: bold;
      margin-left: 0.5rem;
      cursor: pointer;
      color: #4a004a;
    }
    .instagram-link {
      display: inline-block;
      margin-left: 0.4rem;
      vertical-align: middle;
      transition: transform 0.2s ease, opacity 0.2s ease;
    }
    .instagram-link:hover {
      transform: scale(1.1);
      opacity: 0.8;
    }
    .instagram-icon {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      vertical-align: text-bottom;
    }
  </style>
</head>
<body>
<div class="idiomas">
  <button onclick="setLanguage('pt')">PT</button>
  <button onclick="setLanguage('en')">EN</button>
  <button onclick="setLanguage('jp')">JP</button>
</div>

<div class="container">
  <img src="imagens/logo-sweet-family-oficial.png" alt="Sweet Family Logo" class="logo">
  <h1>ğŸ <span id="titulo">ãã˜å¼•ã</span></h1>

  <div class="cupom" id="cupomCode">CARREGANDO...</div>
  <p class="cupom-desconto" id="cupomAviso">â€» ã‚¯ãƒ¼ãƒãƒ³ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>

  <button class="botao-salvar" onclick="window.print()">ğŸ–¨ï¸ <span id="botaoSalvar">ã‚¯ãƒ¼ãƒãƒ³ã‚’ä¿å­˜</span></button>

  <p class="validade" id="validadeLabel">æœ‰åŠ¹æœŸé™: <span id="validade"></span></p>

  <div class="instrucoes">
    <h2 id="comoUsarTitulo">ğŸ“Œ ä½¿ã„æ–¹ï¼š</h2>
    <p id="passo1"></p>
    <img src="imagens/botao-promocode.png" alt="Promo Code Button" class="imagem-teclado">
    <p id="passo2"></p>
    <img src="imagens/teclado-confirmacao.png" alt="Machine Keyboard" class="imagem-teclado">
    <p id="passo3"></p>
    <img src="imagens/valor-premio.png" alt="Prize Value Example" class="imagem-teclado">
    <p id="passo4"></p>

    <p id="valoresPossiveis" class="cupom-desconto"></p>
    <p id="extraChance"></p>

    <div class="instrucoes" style="margin-top: 2.5rem;">
      <h2>ğŸ“„ <span id="regrasTitulo">Regras da PromoÃ§Ã£o</span></h2>
      <ul id="regrasConteudo" style="text-align: left; font-size: 0.9rem; padding-left: 1rem; line-height: 1.6;"></ul>
    </div>
  </div>
</div>
<script>
  const hoje = new Date();
  const hojeStr = hoje.toISOString().split("T")[0];
  const langSalvo = localStorage.getItem("lang_sweetfamily") || "jp";
  const endpoint = "https://script.google.com/macros/s/AKfycbyHQmXsbjpOVGasBGxoY_6MQm42E4_FGCwwupVOLymRVIK6jZBhSyKEGOGN02pPKHaK/exec";

  const traducoes = {
    pt: {
      titulo: "Sorteio",
      botaoSalvar: "Salvar Cupom",
      validade: "(VocÃª tambÃ©m pode tirar um Print) VÃ¡lido atÃ©:",
      comoUsar: "ğŸ“Œ Como usar:",
      passo1: "1 - Toque no botÃ£o rosa â€œPromotion Codeâ€ (canto inferior esquerdo da tela).",
      passo2: "2 - Digite o cÃ³digo do cupom e confirme no botÃ£o azul.",
      passo3: "3 - A mÃ¡quina mostrarÃ¡ o valor do seu prÃªmio no canto inferior esquerdo.",
      passo4: "4 - Se o valor apareceu, funcionou! Agora Ã© sÃ³ comprar normalmente.",
      extraChance: `ğŸ“¸ Chance extra! Poste uma foto com o algodÃ£o doce da Sweet Family e marque @sweetfamily.jp no Instagram para concorrer a um algodÃ£o doce grÃ¡tis. <a href="https://www.instagram.com/sweetfamily.jp" target="_blank" class="instagram-link"><img src="imagens/instagram-icon.png" class="instagram-icon"></a>`,
      descontosPossiveis: "â€» Neste sorteio, vocÃª pode ganhar um cupom de Â¥100, Â¥200, Â¥300, Â¥400 ou Â¥500!",
      desconto: valor => `â€» Este cupom dÃ¡ direito a <span>Â¥${valor}</span> de desconto.`,
      regrasTitulo: "Regras da PromoÃ§Ã£o"
    },
    en: {
      titulo: "Lottery",
      botaoSalvar: "Save Coupon",
      validade: "(You can also take a screenshot) Valid until:",
      comoUsar: "ğŸ“Œ How to use:",
      passo1: "1 - Tap the pink 'Promotion Code' button (bottom left).",
      passo2: "2 - Enter the coupon code and confirm using the blue button.",
      passo3: "3 - The machine will show your prize in the bottom-left corner.",
      passo4: "4 - If a value appeared, it worked! Now complete your purchase.",
      extraChance: `ğŸ“¸ Extra chance! Post a photo with your Sweet Family cotton candy and tag @sweetfamily.jp on Instagram to win one for free! <a href="https://www.instagram.com/sweetfamily.jp" target="_blank" class="instagram-link"><img src="imagens/instagram-icon.png" class="instagram-icon"></a>`,
      descontosPossiveis: "â€» In this lottery, you can win a coupon worth Â¥100, Â¥200, Â¥300, Â¥400, or Â¥500!",
      desconto: valor => `â€» This coupon gives you a <span>Â¥${valor}</span> discount.`,
      regrasTitulo: "Promotion Rules"
    },
    jp: {
      titulo: "ãã˜å¼•ã",
      botaoSalvar: "ã‚¯ãƒ¼ãƒãƒ³ã‚’ä¿å­˜",
      validade: "ï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§ã‚‚OKï¼‰æœ‰åŠ¹æœŸé™:",
      comoUsar: "ğŸ“Œ ä½¿ã„æ–¹ï¼š",
      passo1: "1 - ç”»é¢å·¦ä¸‹ã®ãƒ”ãƒ³ã‚¯ã®ã€Œãƒ—ãƒ­ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚",
      passo2: "2 - ã‚¯ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã€é’ã„ç¢ºèªãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚",
      passo3: "3 - ä»¥ä¸‹ã®ã‚ˆã†ã«ã€ç”»é¢å·¦ä¸‹ã«å½“é¸é‡‘é¡ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚",
      passo4: "4 - é‡‘é¡ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€è³¼å…¥æº–å‚™å®Œäº†ã§ã™ï¼ãã®ã¾ã¾ã”è³¼å…¥ãã ã•ã„ã€‚",
      extraChance: `ğŸ“¸ ãƒãƒ£ãƒ³ã‚¹è¿½åŠ ï¼ã‚¹ã‚¤ãƒ¼ãƒˆãƒ•ã‚¡ãƒŸãƒªãƒ¼ã®ã‚ãŸã‚ã‚ã¨ä¸€ç·’ã«å†™çœŸã‚’æ’®ã£ã¦ã€Instagramã§ @sweetfamily.jp ã‚’ã‚¿ã‚°ä»˜ã‘æŠ•ç¨¿ã™ã‚‹ã¨ã€ç„¡æ–™ã‚ãŸã‚ã‚ãŒå½“ãŸã‚‹ã‹ã‚‚ï¼ <a href="https://www.instagram.com/sweetfamily.jp" target="_blank" class="instagram-link"><img src="imagens/instagram-icon.png" class="instagram-icon"></a>`,
      descontosPossiveis: "â€» æœ¬æ—¥ã®ãã˜å¼•ãã§ã¯ã€Â¥100 / Â¥200 / Â¥300 / Â¥400 / Â¥500 ã®ã„ãšã‚Œã‹ãŒå½“ãŸã‚Šã¾ã™ï¼",
      desconto: valor => `â€» ã“ã®ã‚¯ãƒ¼ãƒãƒ³ã‚’ä½¿ã†ã¨ã€<span>Â¥${valor}</span> å‰²å¼•ã«ãªã‚Šã¾ã™ã€‚`,
      regrasTitulo: "ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã®ãƒ«ãƒ¼ãƒ«"
    }
  };
  function exibirCupom(cupom) {
    const validade = new Date();
    validade.setDate(validade.getDate() + 10);
    const validadeStr = `${validade.getFullYear()}/${String(validade.getMonth() + 1).padStart(2, '0')}/${String(validade.getDate()).padStart(2, '0')}`;
    const t = traducoes[langSalvo];

    document.getElementById("cupomCode").textContent = cupom.code;
    document.getElementById("cupomAviso").innerHTML = `<strong>${t.desconto(cupom.valor)}</strong>`;
    document.getElementById("validadeLabel").innerHTML = `${t.validade} <span id="validade">${validadeStr}</span>`;
    document.getElementById("valoresPossiveis").textContent = t.descontosPossiveis;
  }

  function setLanguage(lang) {
    localStorage.setItem("lang_sweetfamily", lang);
    const t = traducoes[lang];
    document.getElementById("titulo").textContent = t.titulo;
    document.getElementById("botaoSalvar").textContent = t.botaoSalvar;
    document.getElementById("comoUsarTitulo").textContent = t.comoUsar;
    document.getElementById("passo1").innerHTML = `<strong>${t.passo1}</strong>`;
    document.getElementById("passo2").innerHTML = `<strong>${t.passo2}</strong>`;
    document.getElementById("passo3").innerHTML = `<strong>${t.passo3}</strong>`;
    document.getElementById("passo4").innerHTML = `<strong>${t.passo4}</strong>`;
    document.getElementById("extraChance").innerHTML = `<strong>${t.extraChance}</strong>`;
    document.getElementById("regrasTitulo").textContent = t.regrasTitulo;

    const regrasTexto = {
      pt: [
        "Cada pessoa pode participar do sorteio apenas 1 vez por dia.",
        "O cupom Ã© vÃ¡lido por 10 dias a partir da data de geraÃ§Ã£o.",
        "O cupom deve ser digitado na mÃ¡quina antes da compra.",
        "O desconto Ã© aplicado automaticamente no valor da compra.",
        "O cupom Ã© vÃ¡lido somente nas mÃ¡quinas da Sweet Family.",
        "A Sweet Family se reserva o direito de cancelar a promoÃ§Ã£o a qualquer momento, sem aviso prÃ©vio.",
        "Cupons obtidos por meios nÃ£o autorizados serÃ£o considerados invÃ¡lidos."
      ],
      en: [
        "Each person can participate in the lottery only once per day.",
        "The coupon is valid for 10 days from the date it is generated.",
        "The coupon must be entered into the machine before the purchase.",
        "The discount will be applied automatically to the purchase amount.",
        "The coupon is valid only on Sweet Family machines.",
        "Sweet Family reserves the right to cancel the promotion at any time without prior notice.",
        "Coupons obtained through unauthorized means will be considered invalid."
      ],
      jp: [
        "ãŠä¸€äººæ§˜1æ—¥1å›ã¾ã§ãã˜å¼•ãã«å‚åŠ ã§ãã¾ã™ã€‚",
        "ã‚¯ãƒ¼ãƒãƒ³ã¯ç™ºè¡Œæ—¥ã‹ã‚‰10æ—¥é–“æœ‰åŠ¹ã§ã™ã€‚",
        "è³¼å…¥å‰ã«ã‚¯ãƒ¼ãƒãƒ³ã‚³ãƒ¼ãƒ‰ã‚’æ©Ÿæ¢°ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",
        "å‰²å¼•ã¯è‡ªå‹•çš„ã«è³¼å…¥é‡‘é¡ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚",
        "ã‚¯ãƒ¼ãƒãƒ³ã¯ã‚¹ã‚¤ãƒ¼ãƒˆãƒ•ã‚¡ãƒŸãƒªãƒ¼ã®æ©Ÿæ¢°ã®ã¿ã§ä½¿ç”¨å¯èƒ½ã§ã™ã€‚",
        "ã‚¹ã‚¤ãƒ¼ãƒˆãƒ•ã‚¡ãƒŸãƒªãƒ¼ã¯äºˆå‘Šãªãæœ¬ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã‚’çµ‚äº†ã™ã‚‹æ¨©åˆ©ã‚’æœ‰ã—ã¾ã™ã€‚",
        "ä¸æ­£ãªæ–¹æ³•ã§å–å¾—ã•ã‚ŒãŸã‚¯ãƒ¼ãƒãƒ³ã¯ç„¡åŠ¹ã¨ã•ã‚Œã¾ã™ã€‚"
      ]
    };

    const regras = regrasTexto[lang];
    const lista = document.getElementById("regrasConteudo");
    lista.innerHTML = "";
    regras.forEach(txt => {
      const li = document.createElement("li");
      li.textContent = txt;
      lista.appendChild(li);
    });
  }

 const dadosCupom = JSON.parse(localStorage.getItem("sweet_family_cupom_diario") || "{}");

  if (dadosCupom.data === hojeStr) {
    exibirCupom(dadosCupom.cupom);
  } else {
    FingerprintJS.load().then(fp => {
      fp.get().then(result => {
        const id = result.visitorId;

        fetch("https://api.ipify.org?format=json")
          .then(res => res.json())
          .then(ipData => {
            const ip = ipData.ip;

            fetch(`${endpoint}?id=${id}&ip=${ip}&lang=${langSalvo}`)
              .then(res => res.json())
              .then(cupom => {
                if (cupom.error) {
                  alert(`${cupom.error}\nCupom: ${cupom.code || ""} | Â¥${cupom.valor || ""}`);
                }

                if (cupom.code && cupom.valor) {
                  localStorage.setItem("sweet_family_cupom_diario", JSON.stringify({
                    data: hojeStr,
                    cupom: cupom
                  }));
                  exibirCupom(cupom);
                }
              })
              .catch(() => alert("Erro ao comunicar com o servidor."));
          })
          .catch(() => alert("Erro ao obter IP pÃºblico."));
      });
    });
  }

  setLanguage(langSalvo);
</script>
</body>
</html>
