<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>🎁 くじ引き | Sweet Family</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #fff5fb;
      color: #4a004a;
      text-align: center;
      padding: 2rem;
    }
    .container {
      background: #ffffff;
      border-radius: 1.5rem;
      padding: 2rem;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    .logo {
  width: 60%;
  max-width: 280px;
  margin-bottom: 1.5rem;
}

    .cupom {
      background: #ffcbeb;
      padding: 1.5rem;
      border-radius: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
      margin: 1.5rem 0 0.5rem;
    }
    .cupom-desconto {
      font-size: 0.95rem;
      color: #4a004a;
    }
    .validade {
      font-size: 0.9rem;
      color: #888;
    }
    .botao-salvar {
      background-color: #ff92d0;
      color: white;
      border: none;
      padding: 1rem 2rem;
      font-size: 1rem;
      font-weight: bold;
      border-radius: 2rem;
      cursor: pointer;
      margin-top: 1rem;
      transition: background-color 0.3s ease;
    }
    .botao-salvar:hover {
      background-color: #e86db2;
    }
    .instrucoes {
      margin-top: 2rem;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    .imagem-teclado {
      margin-top: 1rem;
      max-width: 240px;
      border-radius: 2rem;
      box-shadow: 0 0 6px rgba(0,0,0,0.2);
    }
    .idiomas {
      position: absolute;
      top: 1rem;
      right: 1rem;
    }
    .idiomas button {
      background: transparent;
      border: none;
      font-weight: bold;
      margin-left: 0.5rem;
      cursor: pointer;
      color: #4a004a;
    }
    .instagram-link {
      display: inline-block;
      margin-left: 0.4rem;
      vertical-align: middle;
      transition: transform 0.2s ease, opacity 0.2s ease;
    }
    .instagram-link:hover {
      transform: scale(1.1);
      opacity: 0.8;
    }
    .instagram-icon {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      vertical-align: text-bottom;
    }
  </style>
</head>
<body>
  <div class="idiomas">
    <button onclick="setLanguage('pt')">PT</button>
    <button onclick="setLanguage('en')">EN</button>
    <button onclick="setLanguage('jp')">JP</button>
  </div>

  <div class="container">
    <img src="imagens/logo-sweet-family-oficial.png" alt="Sweet Family Logo" class="logo">
    <h1>🎁 <span id="titulo">スイートファミリーのくじ引き</span></h1>

    <div class="cupom" id="cupomCode">CARREGANDO...</div>
    <p class="cupom-desconto" id="cupomAviso">※ クーポンを読み込み中...</p>

    <button class="botao-salvar" onclick="window.print()">🖨️ <span id="botaoSalvar">クーポンを保存</span></button>

    <p class="validade" id="validadeLabel">有効期限: <span id="validade"></span></p>

    <div class="instrucoes">
      <h2 id="comoUsarTitulo">📌 使い方：</h2>
      <p id="passo1"><strong>1 - 画面左下のピンクの「プロモーションコード」ボタンをタップしてください。</strong></p>
      <img src="imagens/botao-promocode.png" alt="Promo Code Button" class="imagem-teclado">

      <p id="passo2"><strong>2 - クーポンコードを入力し、青い確認ボタンを押してください。</strong></p>
      <img src="imagens/teclado-confirmacao.png" alt="Machine Keyboard" class="imagem-teclado">

      <p id="passo3"><strong>3 - 以下のように、画面左下に当選金額が表示されます。</strong></p>
      <img src="imagens/valor-premio.png" alt="Prize Value Example" class="imagem-teclado">

      <p id="passo4"><strong>4 - 当選金額が表示されたら、購入準備完了です！そのままご購入ください。</strong></p>

      <p id="valoresPossiveis" class="cupom-desconto"></p>

      <p id="extraChance">
        <strong>
          📸 チャンス追加！スイートファミリーのわたあめと一緒に写真を撮って、Instagramで @sweetfamily.jp をタグ付け投稿すると、無料わたあめが当たるかも！
          <a href="https://www.instagram.com/sweetfamily.jp" target="_blank" class="instagram-link">
            <img src="imagens/instagram-icon.png" alt="Instagram" class="instagram-icon">
          </a>
        </strong>
      </p>
    </div>
  </div>

<script>
  const hoje = new Date();
  const hojeStr = hoje.toISOString().split("T")[0];
  const langSalvo = localStorage.getItem("lang_sweetfamily") || "jp";

  const traducoes = {
    pt: {
      titulo: "Sorteio Sweet Family",
      botaoSalvar: "Salvar Cupom",
      validade: "Válido até:",
      comoUsar: "📌 Como usar:",
      passo1: "1 - Toque no botão rosa “Promotion Code” (canto inferior esquerdo da tela).",
      passo2: "2 - Digite o código do cupom e confirme no botão azul.",
      passo3: "3 - A máquina mostrará o valor do seu prêmio no canto inferior esquerdo.",
      passo4: "4 - Se o valor apareceu, funcionou! Agora é só comprar normalmente.",
      extraChance: "📸 Chance extra! Poste uma foto com o algodão doce da Sweet Family e marque @sweetfamily.jp no Instagram para concorrer a um algodão doce grátis.",
      descontosPossiveis: "※ Neste sorteio, você pode ganhar um cupom de ¥100, ¥200, ¥300, ¥400 ou ¥500!",
      desconto: valor => `※ Este cupom dá direito a ¥${valor} de desconto.`
    },
    en: {
      titulo: "Sweet Family Lottery",
      botaoSalvar: "Save Coupon",
      validade: "Valid until:",
      comoUsar: "📌 How to use:",
      passo1: "1 - Tap the pink 'Promotion Code' button (bottom left).",
      passo2: "2 - Enter the coupon code and confirm using the blue button.",
      passo3: "3 - The machine will show your prize in the bottom-left corner.",
      passo4: "4 - If a value appeared, it worked! Now complete your purchase.",
      extraChance: "📸 Extra chance! Post a photo with your Sweet Family cotton candy and tag @sweetfamily.jp on Instagram to win one for free!",
      descontosPossiveis: "※ In this lottery, you can win a coupon worth ¥100, ¥200, ¥300, ¥400, or ¥500!",
      desconto: valor => `※ This coupon gives you a ¥${valor} discount.`
    },
    jp: {
      titulo: "スイートファミリーのくじ引き",
      botaoSalvar: "クーポンを保存",
      validade: "有効期限:",
      comoUsar: "📌 使い方：",
      passo1: "1 - 画面左下のピンクの「プロモーションコード」ボタンをタップしてください。",
      passo2: "2 - クーポンコードを入力し、青い確認ボタンを押してください。",
      passo3: "3 - 以下のように、画面左下に当選金額が表示されます。",
      passo4: "4 - 金額が表示されたら、購入準備完了です！そのままご購入ください。",
      extraChance: "📸 チャンス追加！スイートファミリーのわたあめと一緒に写真を撮って、Instagramで @sweetfamily.jp をタグ付け投稿すると、無料わたあめが当たるかも！",
      descontosPossiveis: "※ 本日のくじ引きでは、¥100 / ¥200 / ¥300 / ¥400 / ¥500 のいずれかが当たります！",
      desconto: valor => `※ このクーポンを使うと、¥${valor} 割引になります。`
    }
  };

  function exibirCupom(cupom) {
    const validade = new Date();
    validade.setDate(validade.getDate() + 10);
    const validadeStr = `${validade.getFullYear()}/${String(validade.getMonth() + 1).padStart(2, '0')}/${String(validade.getDate()).padStart(2, '0')}`;

    document.getElementById("cupomCode").textContent = cupom.code;
    document.getElementById("validade").textContent = validadeStr;

    const t = traducoes[langSalvo];
    document.getElementById("cupomAviso").innerHTML = `<strong>${t.desconto(cupom.valor)}</strong>`;
    document.getElementById("validadeLabel").innerHTML = `${t.validade} <span id="validade">${validadeStr}</span>`;
    document.getElementById("valoresPossiveis").textContent = t.descontosPossiveis;
  }

  function setLanguage(lang) {
    localStorage.setItem("lang_sweetfamily", lang);
    const t = traducoes[lang];
    document.getElementById("titulo").textContent = t.titulo;
    document.getElementById("botaoSalvar").textContent = t.botaoSalvar;
    document.getElementById("comoUsarTitulo").textContent = t.comoUsar;
    document.getElementById("passo1").innerHTML = `<strong>${t.passo1}</strong>`;
    document.getElementById("passo2").innerHTML = `<strong>${t.passo2}</strong>`;
    document.getElementById("passo3").innerHTML = `<strong>${t.passo3}</strong>`;
    document.getElementById("passo4").innerHTML = `<strong>${t.passo4}</strong>`;
    document.getElementById("extraChance").innerHTML = `<strong>${t.extraChance}</strong>`;
  }

  const dadosCupom = JSON.parse(localStorage.getItem("sweet_family_cupom_diario") || "{}");

  if (dadosCupom.data === hojeStr) {
    exibirCupom(dadosCupom.cupom);
  } else {
    fetch("https://script.google.com/macros/s/AKfycbyHQmXsbjpOVGasBGxoY_6MQm42E4_FGCwwupVOLymRVIK6jZBhSyKEGOGN02pPKHaK/exec")
      .then(res => res.json())
      .then(cupom => {
        if (cupom.error) {
          alert("Sem cupons disponíveis no momento.");
          return;
        }

        localStorage.setItem("sweet_family_cupom_diario", JSON.stringify({
          data: hojeStr,
          cupom
        }));

        fetch("https://script.google.com/macros/s/AKfycbyHQmXsbjpOVGasBGxoY_6MQm42E4_FGCwwupVOLymRVIK6jZBhSyKEGOGN02pPKHaK/exec", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            code: cupom.code,
            valor: cupom.valor,
            lang: langSalvo,
            userAgent: navigator.userAgent
          })
        })
        .then(res => res.text())
        .then(msg => console.log("🟢 RESPOSTA do POST:", msg))
        .catch(err => console.error("❌ ERRO no POST:", err));

        exibirCupom(cupom);
      });
  }

  setLanguage(langSalvo);
</script>
</body>
</html>
