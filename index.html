  <script>
    const hoje = new Date();
    const hojeStr = hoje.toISOString().split("T")[0];
    const langSalvo = localStorage.getItem("lang_sweetfamily") || "jp";

    function exibirCupom(cupom) {
      const validade = new Date();
      validade.setDate(validade.getDate() + 10);
      const validadeStr = `${validade.getFullYear()}/${String(validade.getMonth() + 1).padStart(2, '0')}/${String(validade.getDate()).padStart(2, '0')}`;
      const t = traducoes[langSalvo];

      document.getElementById("cupomCode").textContent = cupom.code;
      document.getElementById("cupomAviso").innerHTML = `<strong>${t.desconto(cupom.valor)}</strong>`;
      document.getElementById("validadeLabel").innerHTML = `${t.validade} <span id="validade">${validadeStr}</span>`;
      document.getElementById("valoresPossiveis").textContent = t.descontosPossiveis;
    }

    function setLanguage(lang) {
      localStorage.setItem("lang_sweetfamily", lang);
      const t = traducoes[lang];

      document.getElementById("titulo").textContent = t.titulo;
      document.getElementById("botaoSalvar").textContent = t.botaoSalvar;
      document.getElementById("comoUsarTitulo").textContent = t.comoUsar;
      document.getElementById("passo1").innerHTML = `<strong>${t.passo1}</strong>`;
      document.getElementById("passo2").innerHTML = `<strong>${t.passo2}</strong>`;
      document.getElementById("passo3").innerHTML = `<strong>${t.passo3}</strong>`;
      document.getElementById("passo4").innerHTML = `<strong>${t.passo4}</strong>`;
      document.getElementById("extraChance").innerHTML = `<strong>${t.extraChance}</strong>`;
      document.getElementById("regrasTitulo").textContent = t.regrasTitulo;
      document.getElementById("cuponsTitulo").textContent = t.cuponsTitulo;
      document.getElementById("cuponsDescricao").textContent = t.cuponsDescricao;
      document.getElementById("pacoteCol").textContent = t.colPacote;
      document.getElementById("cupomCol").textContent = t.colCupom;
      document.getElementById("precoCol").textContent = t.colPreco;
      document.getElementById("quantidadeCol").textContent = t.colQtd;
      document.getElementById("regraCupons").textContent = t.regraCupons;
      atualizarPrecos(lang);

      const regras = {
        pt: [
          "Cada pessoa pode participar do sorteio apenas 1 vez por dia.",
          "O cupom é válido por 10 dias a partir da data de geração.",
          "O cupom deve ser digitado na máquina antes da compra.",
          "O desconto é aplicado automaticamente no valor da compra.",
          "O cupom é válido somente nas máquinas da Sweet Family.",
          "A Sweet Family se reserva o direito de cancelar a promoção a qualquer momento, sem aviso prévio.",
          "Cupons obtidos por meios não autorizados serão considerados inválidos."
        ],
        en: [
          "Each person can participate in the lottery only once per day.",
          "The coupon is valid for 10 days from the date it is generated.",
          "The coupon must be entered into the machine before the purchase.",
          "The discount will be applied automatically to the purchase amount.",
          "The coupon is valid only on Sweet Family machines.",
          "Sweet Family reserves the right to cancel the promotion at any time without prior notice.",
          "Coupons obtained through unauthorized means will be considered invalid."
        ],
        jp: [
          "お一人様1日1回までくじ引きに参加できます。",
          "クーポンは発行日から10日間有効です。",
          "購入前にクーポンコードを機械に入力してください。",
          "割引は自動的に購入金額に適用されます。",
          "クーポンはスイートファミリーの機械のみで使用可能です。",
          "スイートファミリーは予告なく本キャンペーンを終了する権利を有します。",
          "不正な方法で取得されたクーポンは無効とされます。"
        ]
      };

      const ul = document.getElementById("regrasConteudo");
      ul.innerHTML = "";
      regras[lang].forEach(txt => {
        const li = document.createElement("li");
        li.textContent = txt;
        ul.appendChild(li);
      });
    }

    const dadosCupom = JSON.parse(localStorage.getItem("sweet_family_cupom_diario") || "{}");
    if (dadosCupom.data === hojeStr) {
      exibirCupom(dadosCupom.cupom);
    } else {
      fetch("https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec")
        .then(res => res.json())
        .then(cupom => {
          if (cupom.error) {
            alert("Sem cupons disponíveis no momento.");
            return;
          }
          localStorage.setItem("sweet_family_cupom_diario", JSON.stringify({ data: hojeStr, cupom }));
          exibirCupom(cupom);
        });
    }

    setLanguage(langSalvo);
  </script>
</body>
</html>
